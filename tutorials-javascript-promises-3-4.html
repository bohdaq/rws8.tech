<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9724DKC9BF"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-9724DKC9BF');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Lesson 3.4: Promise.any() - Get the first successful Promise result.">
    <meta name="keywords" content="JavaScript, Promises, Promise.any, Tutorial">
    <meta name="author" content="bohdaq">
    <title>Lesson 3.4: Promise.any() | bohdaq</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="canonical" href="https://rws8.tech/tutorials-javascript-promises-3-4.html">
    <style>
        .lesson-content {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }
        .lesson-content h2 {
            margin-top: 2.5rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0.5rem;
        }
        .lesson-content h3 {
            margin-top: 2rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }
        .lesson-content pre {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            overflow-x: auto;
            margin: 1.5rem 0;
        }
        .lesson-content code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9em;
        }
        .lesson-content ul, .lesson-content ol {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }
        .lesson-content li {
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }
        .lesson-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 2px solid var(--border-color);
        }
        .objectives-box {
            background-color: var(--bg-secondary);
            border-left: 4px solid var(--primary-color);
            padding: 1.5rem;
            margin: 2rem 0;
            border-radius: 4px;
        }
        .objectives-box h3 {
            margin-top: 0;
        }
        .key-takeaways {
            background-color: #f0f9ff;
            border-left: 4px solid var(--primary-color);
            padding: 1.5rem;
            margin: 2rem 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="logo">bohdaq</a>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="fullstack.html">Fullstack</a></li>
                <li><a href="frontend.html">Frontend</a></li>
                <li><a href="backend.html">Backend</a></li>
                <li><a href="tutorials.html" class="active">Tutorials</a></li>
                <li><a href="https://github.com/bohdaq" target="_blank" rel="nofollow noopener">GitHub</a></li>
            </ul>
        </div>
    </nav>

    <header class="page-header">
        <div class="container">
            <h1>Lesson 3.4: Promise.any()</h1>
            <p class="page-subtitle">JavaScript Promises Tutorial - Section 3: Static Methods</p>
        </div>
    </header>

    <section class="content-section">
        <div class="lesson-content">
            <div class="objectives-box">
                <h3>Learning Objectives</h3>
                <ul>
                    <li>Understand Promise.any() behavior</li>
                    <li>Learn the difference from Promise.race()</li>
                    <li>Handle AggregateError</li>
                    <li>Implement fallback strategies</li>
                </ul>
            </div>

            <h2>What is Promise.any()?</h2>
            <p><code>Promise.any()</code> returns a Promise that fulfills as soon as <strong>any</strong> of the input Promises fulfills. It only rejects if <strong>all</strong> Promises reject.</p>

            <pre><code>Promise.any([promise1, promise2, promise3])
  .then(result => {
    // First successful result
  })
  .catch(error => {
    // AggregateError if ALL failed
  });</code></pre>

            <h2>Basic Example</h2>

            <pre><code>const promises = [
  Promise.reject('Error 1'),
  Promise.resolve('Success!'),
  Promise.reject('Error 2')
];

Promise.any(promises)
  .then(result => {
    console.log(result); // "Success!"
  })
  .catch(error => {
    console.error('All failed');
  });</code></pre>

            <h2>Promise.any() vs Promise.race()</h2>

            <table style="width: 100%; border-collapse: collapse; margin: 2rem 0;">
                <thead>
                    <tr style="background-color: var(--bg-secondary);">
                        <th style="border: 1px solid var(--border-color); padding: 1rem;">Feature</th>
                        <th style="border: 1px solid var(--border-color); padding: 1rem;">Promise.any()</th>
                        <th style="border: 1px solid var(--border-color); padding: 1rem;">Promise.race()</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="border: 1px solid var(--border-color); padding: 1rem;"><strong>Resolves when</strong></td>
                        <td style="border: 1px solid var(--border-color); padding: 1rem;">First fulfillment</td>
                        <td style="border: 1px solid var(--border-color); padding: 1rem;">First settlement (fulfill or reject)</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid var(--border-color); padding: 1rem;"><strong>Rejects when</strong></td>
                        <td style="border: 1px solid var(--border-color); padding: 1rem;">All reject</td>
                        <td style="border: 1px solid var(--border-color); padding: 1rem;">First rejection</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid var(--border-color); padding: 1rem;"><strong>Ignores</strong></td>
                        <td style="border: 1px solid var(--border-color); padding: 1rem;">Rejections (until all fail)</td>
                        <td style="border: 1px solid var(--border-color); padding: 1rem;">Nothing</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid var(--border-color); padding: 1rem;"><strong>Use case</strong></td>
                        <td style="border: 1px solid var(--border-color); padding: 1rem;">Fallback sources</td>
                        <td style="border: 1px solid var(--border-color); padding: 1rem;">Fastest response</td>
                    </tr>
                </tbody>
            </table>

            <h2>Common Use Cases</h2>

            <h3>1. Fallback API Endpoints</h3>

            <pre><code>async function fetchFromMultipleSources(endpoint) {
  const sources = [
    fetch(`https://api1.example.com${endpoint}`),
    fetch(`https://api2.example.com${endpoint}`),
    fetch(`https://api3.example.com${endpoint}`)
  ];
  
  try {
    const response = await Promise.any(sources);
    return await response.json();
  } catch (error) {
    throw new Error('All API sources failed');
  }
}

fetchFromMultipleSources('/data')
  .then(data => console.log('Got data:', data))
  .catch(error => console.error(error));</code></pre>

            <h3>2. CDN Fallbacks</h3>

            <pre><code>function loadScript(src) {
  return new Promise((resolve, reject) => {
    const script = document.createElement('script');
    script.onload = () => resolve(src);
    script.onerror = () => reject(new Error(`Failed: ${src}`));
    script.src = src;
    document.head.appendChild(script);
  });
}

const cdns = [
  'https://cdn1.example.com/library.js',
  'https://cdn2.example.com/library.js',
  'https://cdn3.example.com/library.js'
];

Promise.any(cdns.map(loadScript))
  .then(src => console.log('Loaded from:', src))
  .catch(() => console.error('All CDNs failed'));</code></pre>

            <h3>3. Database Replicas</h3>

            <pre><code>async function queryFromReplicas(query) {
  const replicas = [
    queryDatabase('primary', query),
    queryDatabase('replica1', query),
    queryDatabase('replica2', query)
  ];
  
  return Promise.any(replicas);
}

queryFromReplicas('SELECT * FROM users')
  .then(results => console.log('Query results:', results))
  .catch(error => console.error('All replicas failed'));</code></pre>

            <h2>AggregateError</h2>

            <p>When all Promises reject, <code>Promise.any()</code> throws an <code>AggregateError</code> containing all rejection reasons:</p>

            <pre><code>const promises = [
  Promise.reject(new Error('Error 1')),
  Promise.reject(new Error('Error 2')),
  Promise.reject(new Error('Error 3'))
];

Promise.any(promises)
  .catch(error => {
    console.log(error instanceof AggregateError); // true
    console.log(error.errors); // Array of all errors
    
    error.errors.forEach((err, index) => {
      console.log(`Promise ${index + 1}:`, err.message);
    });
  });</code></pre>

            <h2>Handling AggregateError</h2>

            <pre><code>async function fetchWithFallbacks(urls) {
  try {
    const response = await Promise.any(
      urls.map(url => fetch(url))
    );
    return await response.json();
  } catch (error) {
    if (error instanceof AggregateError) {
      console.error('All sources failed:');
      error.errors.forEach((err, i) => {
        console.error(`  Source ${i + 1}:`, err.message);
      });
    }
    throw new Error('Failed to fetch from any source');
  }
}</code></pre>

            <h2>Real-World Example: Image Loading with Fallbacks</h2>

            <pre><code>function loadImage(url) {
  return new Promise((resolve, reject) => {
    const img = new Image();
    img.onload = () => resolve(img);
    img.onerror = () => reject(new Error(`Failed: ${url}`));
    img.src = url;
  });
}

async function loadImageWithFallbacks(imageName) {
  const sources = [
    `https://cdn1.example.com/images/${imageName}`,
    `https://cdn2.example.com/images/${imageName}`,
    `https://cdn3.example.com/images/${imageName}`,
    `/local/images/${imageName}` // Local fallback
  ];
  
  try {
    const img = await Promise.any(sources.map(loadImage));
    document.body.appendChild(img);
    return img;
  } catch (error) {
    console.error('All image sources failed');
    // Show placeholder
    const placeholder = document.createElement('div');
    placeholder.textContent = 'Image not available';
    document.body.appendChild(placeholder);
  }
}

loadImageWithFallbacks('photo.jpg');</code></pre>

            <h2>Combining with Other Methods</h2>

            <h3>Promise.any() + Timeout</h3>

            <pre><code>function timeout(ms) {
  return new Promise((_, reject) => 
    setTimeout(() => reject(new Error('Timeout')), ms)
  );
}

async function fetchWithFallbacksAndTimeout(urls, timeoutMs) {
  const fetchPromises = urls.map(url => 
    Promise.race([
      fetch(url),
      timeout(timeoutMs)
    ])
  );
  
  return Promise.any(fetchPromises);
}

fetchWithFallbacksAndTimeout([
  'https://slow-api.com/data',
  'https://fast-api.com/data'
], 5000)
  .then(response => response.json())
  .then(data => console.log(data))
  .catch(error => console.error('All attempts failed or timed out'));</code></pre>

            <h2>Polyfill for Older Browsers</h2>

            <pre><code>if (!Promise.any) {
  Promise.any = function(promises) {
    return new Promise((resolve, reject) => {
      const errors = [];
      let rejectedCount = 0;
      
      promises.forEach((promise, index) => {
        Promise.resolve(promise)
          .then(resolve)
          .catch(error => {
            errors[index] = error;
            rejectedCount++;
            
            if (rejectedCount === promises.length) {
              reject(new AggregateError(
                errors,
                'All promises were rejected'
              ));
            }
          });
      });
    });
  };
}</code></pre>

            <h2>Best Practices</h2>

            <ol>
                <li><strong>Use for redundancy</strong> - Multiple sources where any success is acceptable</li>
                <li><strong>Order matters</strong> - Put preferred sources first for better performance</li>
                <li><strong>Handle AggregateError</strong> - Always check for all failures</li>
                <li><strong>Combine with timeouts</strong> - Prevent slow sources from delaying results</li>
                <li><strong>Log failures</strong> - Track which sources are failing for monitoring</li>
            </ol>

            <h2>Comparison Summary</h2>

            <pre><code>// Promise.all() - All must succeed
const [a, b, c] = await Promise.all([p1, p2, p3]);
// Rejects if ANY fails

// Promise.allSettled() - Wait for all, get all results
const results = await Promise.allSettled([p1, p2, p3]);
// Never rejects, returns status for each

// Promise.race() - First to settle wins
const result = await Promise.race([p1, p2, p3]);
// Settles with first (success or failure)

// Promise.any() - First success wins
const result = await Promise.any([p1, p2, p3]);
// Rejects only if ALL fail</code></pre>

            <div class="key-takeaways">
                <h3>Key Takeaways</h3>
                <ul>
                    <li>✅ <code>Promise.any()</code> resolves with <strong>first success</strong></li>
                    <li>✅ Ignores rejections until <strong>all fail</strong></li>
                    <li>✅ Throws <code>AggregateError</code> when all reject</li>
                    <li>✅ Perfect for <strong>fallback strategies</strong></li>
                    <li>✅ Different from <code>Promise.race()</code> - ignores rejections</li>
                    <li>✅ Great for redundant data sources</li>
                </ul>
            </div>

            <h2>Next Steps</h2>
            <p>Now that you've mastered all Promise static methods, let's move on to async/await!</p>

            <div class="lesson-nav">
                <a href="tutorials-javascript-promises-3-3.html" class="btn btn-secondary">← Previous: Promise.allSettled()</a>
                <a href="tutorials-javascript-promises-4-1.html" class="btn btn-primary">Next: Async/Await →</a>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <p>&copy; 2025 bohdaq. All rights reserved.</p>
            <div class="footer-links">
                <a href="https://github.com/bohdaq" target="_blank" rel="nofollow noopener">GitHub</a>
                <a href="https://crates.io/users/bohdaq" target="_blank" rel="nofollow noopener">crates.io</a>
                <a href="https://orcid.org/0000-0002-5221-5607" target="_blank" rel="nofollow noopener">ORCID</a>
            </div>
        </div>
    </footer>
</body>
</html>
