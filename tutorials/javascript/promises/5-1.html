<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9724DKC9BF"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-9724DKC9BF');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Lesson 5.1: Promise Utilities - Build reusable Promise utilities and helper functions.">
    <meta name="keywords" content="JavaScript, Promises, Utilities, Helper Functions, Tutorial">
    <meta name="author" content="bohdaq">
    <title>Lesson 5.1: Promise Utilities | bohdaq</title>
    <link rel="stylesheet" href="../../../styles.css">
    <link rel="canonical" href="https://rws8.tech/tutorials-javascript-promises-5-1.html">
    <link rel="stylesheet" href="../../../assets/prism/prism.css">
    <style>
        .lesson-content {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }
        .lesson-content h2 {
            margin-top: 2.5rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0.5rem;
        }
        .lesson-content h3 {
            margin-top: 2rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }
        .lesson-content code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9em;
        }
        .lesson-content ul, .lesson-content ol {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }
        .lesson-content li {
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }
        .lesson-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 2px solid var(--border-color);
        }
        .objectives-box {
            background-color: var(--bg-secondary);
            border-left: 4px solid var(--primary-color);
            padding: 1.5rem;
            margin: 2rem 0;
            border-radius: 4px;
        }
        .objectives-box h3 {
            margin-top: 0;
        }
        .key-takeaways {
            background-color: #f0f9ff;
            border-left: 4px solid var(--primary-color);
            padding: 1.5rem;
            margin: 2rem 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="../../../index.html" class="logo">bohdaq</a>
            <ul class="nav-links">
                <li><a href="../../../index.html">Home</a></li>
                <li><a href="../../../fullstack.html">Fullstack</a></li>
                <li><a href="../../../frontend.html">Frontend</a></li>
                <li><a href="../../../backend.html">Backend</a></li>
                <li><a href="../../../tutorials.html" class="active">Tutorials</a></li>
            </ul>
        </div>
    </nav>
    <section class="breadcrumbs">
        <div class="container">
            <nav aria-label="Breadcrumb">
                <a href="../../../index.html">Home</a>
                <span class="separator">›</span>
                <a href="../../../tutorials.html">Tutorials</a>
                <span class="separator">›</span>
                <a href="../index.html">JavaScript</a>
                <span class="separator">›</span>
                <a href="index.html">Promises</a>
                <span class="separator">›</span>
                <span class="current">Lesson</span>
            </nav>
        </div>
    </section>


    <header class="page-header">
        <div class="container">
            <h1>Lesson 5.1: Promise Composition and Utilities</h1>
            <p class="page-subtitle">JavaScript Promises Tutorial - Section 5: Advanced Patterns</p>
        </div>
    </header>

    <section class="content-section">
        <div class="lesson-content">
            <div class="objectives-box">
                <h3>Learning Objectives</h3>
                <ul>
                    <li>Create reusable Promise utilities</li>
                    <li>Master the promisify pattern</li>
                    <li>Build delay/sleep functions</li>
                    <li>Develop a Promise utility library</li>
                </ul>
            </div>

            <h2>Why Build Promise Utilities?</h2>
            <p>Reusable utilities make your code:</p>
            <ul>
                <li>✅ More maintainable</li>
                <li>✅ Less repetitive (DRY principle)</li>
                <li>✅ Easier to test</li>
                <li>✅ More readable</li>
            </ul>

            <h2>Essential Promise Utilities</h2>

            <h3>1. Delay/Sleep Function</h3>
            <p>Create a Promise-based delay:</p>

            <pre><code class="language-javascript">function delay(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

// Usage
await delay(1000); // Wait 1 second
console.log('1 second later');</code></pre>

            <p>With value:</p>
            <pre><code class="language-javascript">function delay(ms, value) {
  return new Promise(resolve => {
    setTimeout(() => resolve(value), ms);
  });
}

const result = await delay(1000, 'Hello');
console.log(result); // 'Hello' after 1 second</code></pre>

            <h3>2. Timeout Wrapper</h3>
            <p>Add timeout to any Promise:</p>

            <pre><code class="language-javascript">function timeout(promise, ms) {
  return Promise.race([
    promise,
    new Promise((_, reject) => {
      setTimeout(() => reject(new Error('Timeout')), ms);
    })
  ]);
}

// Usage
try {
  const data = await timeout(fetchData(), 5000);
  console.log(data);
} catch (error) {
  console.error('Request timed out');
}</code></pre>

            <h3>3. Retry Function</h3>
            <p>Retry failed operations:</p>

            <pre><code class="language-javascript">async function retry(fn, retries = 3, delay = 1000) {
  try {
    return await fn();
  } catch (error) {
    if (retries <= 0) {
      throw error;
    }
    
    console.log(`Retrying... (${retries} attempts left)`);
    await new Promise(resolve => setTimeout(resolve, delay));
    return retry(fn, retries - 1, delay);
  }
}

// Usage
const data = await retry(() => fetchData(), 3, 1000);</code></pre>

            <h3>4. Promisify Pattern</h3>
            <p>Convert callback-based functions to Promises:</p>

            <pre><code class="language-javascript">function promisify(fn) {
  return function(...args) {
    return new Promise((resolve, reject) => {
      fn(...args, (error, result) => {
        if (error) {
          reject(error);
        } else {
          resolve(result);
        }
      });
    });
  };
}

// Usage
const fs = require('fs');
const readFileAsync = promisify(fs.readFile);

const content = await readFileAsync('file.txt', 'utf8');</code></pre>

            <h3>5. Sequential Execution</h3>
            <p>Run Promises one after another:</p>

            <pre><code class="language-javascript">async function sequential(tasks) {
  const results = [];
  
  for (const task of tasks) {
    const result = await task();
    results.push(result);
  }
  
  return results;
}

// Usage
const results = await sequential([
  () => fetchUser(1),
  () => fetchUser(2),
  () => fetchUser(3)
]);</code></pre>

            <h3>6. Parallel with Limit</h3>
            <p>Control concurrency:</p>

            <pre><code class="language-javascript">async function parallelLimit(tasks, limit) {
  const results = [];
  const executing = [];
  
  for (const task of tasks) {
    const promise = Promise.resolve().then(() => task());
    results.push(promise);
    
    if (limit <= tasks.length) {
      const e = promise.then(() => {
        executing.splice(executing.indexOf(e), 1);
      });
      executing.push(e);
      
      if (executing.length >= limit) {
        await Promise.race(executing);
      }
    }
  }
  
  return Promise.all(results);
}

// Usage: Run max 3 tasks at once
const results = await parallelLimit(tasks, 3);</code></pre>

            <h3>7. Map with Promises</h3>
            <p>Transform array items asynchronously:</p>

            <pre><code class="language-javascript">async function mapAsync(array, asyncFn) {
  return Promise.all(array.map(asyncFn));
}

// Usage
const userIds = [1, 2, 3, 4, 5];
const users = await mapAsync(userIds, id => fetchUser(id));</code></pre>

            <h3>8. Filter with Promises</h3>
            <p>Filter array with async predicate:</p>

            <pre><code class="language-javascript">async function filterAsync(array, asyncPredicate) {
  const results = await Promise.all(
    array.map(async item => ({
      item,
      pass: await asyncPredicate(item)
    }))
  );
  
  return results
    .filter(result => result.pass)
    .map(result => result.item);
}

// Usage
const activeUsers = await filterAsync(users, 
  user => checkIfActive(user.id)
);</code></pre>

            <h2>Building a Complete Utility Library</h2>

            <pre><code class="language-javascript">// promiseUtils.js
const PromiseUtils = {
  delay: (ms, value) => new Promise(resolve => 
    setTimeout(() => resolve(value), ms)
  ),
  
  timeout: (promise, ms) => Promise.race([
    promise,
    new Promise((_, reject) => 
      setTimeout(() => reject(new Error('Timeout')), ms)
    )
  ]),
  
  retry: async (fn, retries = 3, delay = 1000) => {
    try {
      return await fn();
    } catch (error) {
      if (retries <= 0) throw error;
      await PromiseUtils.delay(delay);
      return PromiseUtils.retry(fn, retries - 1, delay * 2);
    }
  },
  
  sequential: async (tasks) => {
    const results = [];
    for (const task of tasks) {
      results.push(await task());
    }
    return results;
  },
  
  mapAsync: (array, fn) => Promise.all(array.map(fn)),
  
  filterAsync: async (array, predicate) => {
    const results = await Promise.all(
      array.map(async item => ({
        item,
        pass: await predicate(item)
      }))
    );
    return results.filter(r => r.pass).map(r => r.item);
  }
};

export default PromiseUtils;</code></pre>

            <h2>Real-World Example: API Client with Utilities</h2>

            <pre><code class="language-javascript">class APIClient {
  constructor(baseURL) {
    this.baseURL = baseURL;
  }
  
  async request(endpoint, options = {}) {
    const url = `${this.baseURL}${endpoint}`;
    
    // Add timeout
    const fetchWithTimeout = PromiseUtils.timeout(
      fetch(url, options),
      5000
    );
    
    // Add retry logic
    return PromiseUtils.retry(
      async () => {
        const response = await fetchWithTimeout;
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }
        return response.json();
      },
      3,
      1000
    );
  }
  
  async batchGet(endpoints) {
    return PromiseUtils.mapAsync(
      endpoints,
      endpoint => this.request(endpoint)
    );
  }
}

// Usage
const api = new APIClient('https://api.example.com');
const data = await api.batchGet(['/users', '/posts', '/comments']);</code></pre>

            <div class="key-takeaways">
                <h3>Key Takeaways</h3>
                <ul>
                    <li>✅ Build reusable utilities for common async patterns</li>
                    <li>✅ <code>delay()</code> creates Promise-based timeouts</li>
                    <li>✅ <code>timeout()</code> adds time limits to Promises</li>
                    <li>✅ <code>retry()</code> implements automatic retry logic</li>
                    <li>✅ <code>promisify()</code> converts callbacks to Promises</li>
                    <li>✅ Utility libraries improve code maintainability</li>
                </ul>
            </div>

            <h2>Next Steps</h2>
            <p>Continue exploring advanced patterns or jump to testing async code in Section 7!</p>

            <div class="lesson-nav">
                <a href="4-1.html" class="btn btn-secondary">← Previous: Async/Await</a>
                <a href="7-1.html" class="btn btn-primary">Next: Testing Async →</a>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <p>&copy; 2025 bohdaq. All rights reserved.</p>
            <div class="footer-links">
                <a href="https://github.com/bohdaq" target="_blank" rel="nofollow noopener">GitHub</a>
                <a href="https://crates.io/users/bohdaq" target="_blank" rel="nofollow noopener">crates.io</a>
                <a href="https://orcid.org/0000-0002-5221-5607" target="_blank" rel="nofollow noopener">ORCID</a>
            </div>
        </div>
    </footer>
    <script src="../../../assets/prism/prism.js"></script>
    <script src="../../../assets/prism/prism-javascript.js"></script>
</body>
</html>
